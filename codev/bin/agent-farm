#!/bin/bash
# Thin wrapper - forwards all commands to @cluesmith/codev agent-farm
# Uses readlink to handle symlinks (e.g., if symlinked to /usr/local/bin)
SCRIPT_PATH="$(readlink -f "$0" 2>/dev/null || realpath "$0" 2>/dev/null || echo "$0")"
SCRIPT_DIR="$(cd "$(dirname "$SCRIPT_PATH")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/../.." && pwd)"

# Try local development version first (for codev self-hosting)
if [ -f "$PROJECT_ROOT/packages/codev/dist/cli.js" ]; then
  exec node "$PROJECT_ROOT/packages/codev/dist/cli.js" agent-farm "$@"
fi

# Fall back to globally installed 'af' command
if command -v af &> /dev/null; then
  exec af "$@"
fi

# Fall back to npx if nothing else works
if command -v npx &> /dev/null; then
  exec npx @cluesmith/codev af "$@"
fi

echo "Error: Could not find agent-farm CLI" >&2
echo "Run 'npm run build' in packages/codev or install globally" >&2
exit 1
